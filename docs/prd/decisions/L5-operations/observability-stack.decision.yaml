# Observability Stack
#
# How the system is monitored, traced, and debugged in production.

decision_id: observability_stack
title: "Observability Stack"
description: >
  Determines the monitoring, logging, tracing, and alerting infrastructure.
  In attribution/traceability systems, observability serves a dual purpose:
  operational health monitoring AND confidence score tracking (e.g., tracking
  calibration drift over time via Langfuse).

decision_level: L5_operations
status: active
last_updated: 2026-02-22

options:
  - option_id: langfuse_plus_platform
    title: "Langfuse + Platform Metrics"
    description: >
      Langfuse for LLM tracing and confidence tracking, platform-native
      metrics (Render/Railway dashboards) for infrastructure. Minimal
      setup, good for LLM-heavy systems. Current scaffold default.
    prior_probability: 0.30
    status: recommended

  - option_id: grafana_stack
    title: "Grafana Stack (Prometheus + Loki + Tempo)"
    description: >
      Full open-source observability: Prometheus for metrics, Loki for
      logs, Tempo for traces, Grafana for dashboards. Self-hosted or
      Grafana Cloud. Comprehensive but requires setup. Prometheus 3.0
      (Nov 2025) adds native OTLP ingestion, UTF-8 metric names, and
      Remote Write 2.0 — significantly reducing the gap with OTel-native
      solutions.
    prior_probability: 0.25
    status: viable
    constraints:
      - "Grafana/Prometheus operational knowledge"
      - "Infrastructure for running the stack"

  - option_id: datadog
    title: "Datadog"
    description: >
      Enterprise-grade SaaS observability with APM, logs, metrics,
      and tracing in one platform. Excellent but expensive at scale.
    prior_probability: 0.15
    status: viable
    constraints:
      - "Budget for Datadog pricing ($15-30/host/month+)"
      - "Vendor lock-in on dashboard definitions"

  - option_id: posthog_sentry
    title: "PostHog + Sentry"
    description: >
      PostHog for product analytics, feature flags, session replay,
      and A/B experiments. Sentry for error tracking and performance
      monitoring. PostHog free tier: 1M events/month, 5K session
      recordings. Sentry self-hosted includes all features.
      NOTE: Highlight.io shut down Feb 28, 2026 (LaunchDarkly acquisition).
    prior_probability: 0.30
    status: recommended

  - option_id: minimal_logging
    title: "Minimal (Structured Logging Only)"
    description: >
      Structured JSON logging to stdout, consumed by platform log
      aggregation. No dedicated metrics, tracing, or dashboards.
      Sufficient for early-stage MVPs.
    prior_probability: 0.20
    status: viable

conditional_on:
  - parent_decision_id: build_vs_buy_posture
    influence_strength: moderate
    conditional_table:
      - given_parent_option: custom_build
        then_probabilities:
          langfuse_plus_platform: 0.15
          grafana_stack: 0.35
          datadog: 0.10
          posthog_sentry: 0.25
          minimal_logging: 0.15
      - given_parent_option: managed_services
        then_probabilities:
          langfuse_plus_platform: 0.25
          grafana_stack: 0.15
          datadog: 0.15
          posthog_sentry: 0.25
          minimal_logging: 0.20
      - given_parent_option: saas_maximalist
        then_probabilities:
          langfuse_plus_platform: 0.20
          grafana_stack: 0.10
          datadog: 0.15
          posthog_sentry: 0.30
          minimal_logging: 0.25

  - parent_decision_id: ai_framework_strategy
    influence_strength: moderate
    conditional_table:
      - given_parent_option: direct_api_pydantic
        then_probabilities:
          langfuse_plus_platform: 0.25
          grafana_stack: 0.20
          datadog: 0.10
          posthog_sentry: 0.30
          minimal_logging: 0.15
      - given_parent_option: lightweight_sdk
        then_probabilities:
          langfuse_plus_platform: 0.25
          grafana_stack: 0.20
          datadog: 0.10
          posthog_sentry: 0.30
          minimal_logging: 0.15
      - given_parent_option: orchestration_framework
        then_probabilities:
          langfuse_plus_platform: 0.30
          grafana_stack: 0.20
          datadog: 0.10
          posthog_sentry: 0.25
          minimal_logging: 0.15
      - given_parent_option: no_llm
        then_probabilities:
          langfuse_plus_platform: 0.10
          grafana_stack: 0.25
          datadog: 0.15
          posthog_sentry: 0.20
          minimal_logging: 0.30

archetype_weights:
  engineer_heavy_startup:
    probability_overrides:
      langfuse_plus_platform: 0.20
      grafana_stack: 0.30
      datadog: 0.10
      posthog_sentry: 0.25
      minimal_logging: 0.15
    rationale: "Engineers build Grafana dashboards and appreciate open-source stack. PostHog for product analytics."

  musician_first_team:
    probability_overrides:
      langfuse_plus_platform: 0.20
      grafana_stack: 0.05
      datadog: 0.05
      posthog_sentry: 0.35
      minimal_logging: 0.35
    rationale: "PostHog free tier for analytics and feature flags. Minimal logging as fallback."

  solo_hacker:
    probability_overrides:
      langfuse_plus_platform: 0.15
      grafana_stack: 0.05
      datadog: 0.05
      posthog_sentry: 0.30
      minimal_logging: 0.45
    rationale: "PostHog free tier for analytics. Structured logging to stdout as baseline."

  well_funded_startup:
    probability_overrides:
      langfuse_plus_platform: 0.20
      grafana_stack: 0.20
      datadog: 0.25
      posthog_sentry: 0.25
      minimal_logging: 0.10
    rationale: "Datadog for enterprise SLAs, PostHog for product analytics. Best of both worlds."

research_notes: >
  Prometheus 3.0 + OTel Convergence (Feb 2026 assessment): UTF-8 metric names
  eliminate naming friction between Prometheus and OTel conventions. OTLP is
  now a native ingestion protocol — no conversion proxies needed. OTel is
  evaluating adoption of Prometheus exposition specs. Richard Hartmann
  (Grafana Labs) frames this as "less tyranny of choice — one way to do
  things that works on both sides."

  LLM Observability Blind Spots: Traditional metrics/logs/traces were designed
  for deterministic systems. LLM applications introduce: (1) probabilistic
  output quality requiring prompt/completion tracing, (2) token-based cost
  attribution, (3) multi-hop agent pipeline tracing, (4) RAG retrieval
  quality scoring, (5) persona/behavioral drift (8-turn cliff), (6) eBPF
  for zero-instrumentation network-level LLM call visibility.

  See: docs/knowledge-base/technical/observability/prometheus-otel-convergence-2026.md

volatility:
  classification: stable
  last_assessed: 2026-02-22
  next_review: 2026-05-22
  change_drivers:
    - "Langfuse feature expansion"
    - "OpenTelemetry ecosystem maturity"
    - "Prometheus 3.0 OTLP convergence impact"
    - "Datadog pricing changes"
    - "LLM-specific observability tooling emergence"

domain_applicability:
  music_attribution: 1.0
  dpp_traceability: 1.0
  generic_graph_rag: 1.0

tags:
  - operations
  - observability
  - monitoring

references:
  - "../observability/toc-observability.md"
  - "../observability/langfuse.md"
  - "../defaults.yaml"
