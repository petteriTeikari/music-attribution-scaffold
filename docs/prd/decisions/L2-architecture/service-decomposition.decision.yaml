# Service Decomposition
#
# How is the system decomposed? Monolith, modular monolith,
# or microservices? Affects deployment complexity and team scaling.

decision_id: service_decomposition
title: "Service Decomposition"
description: >
  Determines the system's deployment unit boundaries. A monolith deploys
  as a single process; a modular monolith maintains internal boundaries
  but deploys together; microservices deploy independently. This decision
  strongly correlates with team size and operational capacity.

decision_level: L2_architecture
status: active
last_updated: 2026-02-10

options:
  - option_id: monolith
    title: "Monolith"
    description: >
      Single deployable unit. All components (attribution engine,
      API server, background workers) in one process. Simplest
      deployment, easiest debugging, lowest operational overhead.
    prior_probability: 0.35
    status: recommended

  - option_id: modular_monolith
    title: "Modular Monolith"
    description: >
      Single deployment unit with strict internal module boundaries
      (Python packages with defined interfaces). Prepared for future
      decomposition but avoids distributed systems complexity now.
    prior_probability: 0.35
    status: recommended
    complements:
      - "build_vs_buy_posture.managed_services"

  - option_id: microservices
    title: "Microservices"
    description: >
      Independent services for attribution engine, API gateway,
      background workers, and potentially per-source adapters.
      Requires service mesh, distributed tracing, and container
      orchestration.
    prior_probability: 0.15
    status: viable
    constraints:
      - "Team size >= 5 engineers"
      - "Container orchestration infrastructure"
      - "Distributed tracing and observability"

  - option_id: serverless_functions
    title: "Serverless Functions"
    description: >
      Event-driven architecture with cloud functions (AWS Lambda,
      Vercel Functions, Cloudflare Workers). Each API endpoint or
      background task is an independent function. Minimal ops but
      cold start latency and vendor lock-in.
    prior_probability: 0.15
    status: viable
    constraints:
      - "Stateless request handling"
      - "Acceptance of cold start latency"
      - "Cloud vendor dependency"

conditional_on:
  - parent_decision_id: build_vs_buy_posture
    influence_strength: strong
    conditional_table:
      - given_parent_option: custom_build
        then_probabilities:
          monolith: 0.20
          modular_monolith: 0.35
          microservices: 0.35
          serverless_functions: 0.10
      - given_parent_option: managed_services
        then_probabilities:
          monolith: 0.35
          modular_monolith: 0.40
          microservices: 0.10
          serverless_functions: 0.15
      - given_parent_option: saas_maximalist
        then_probabilities:
          monolith: 0.30
          modular_monolith: 0.20
          microservices: 0.05
          serverless_functions: 0.45

archetype_weights:
  engineer_heavy_startup:
    probability_overrides:
      monolith: 0.15
      modular_monolith: 0.40
      microservices: 0.35
      serverless_functions: 0.10
    rationale: "Engineers can handle microservices but often wisely choose modular monolith first."

  musician_first_team:
    probability_overrides:
      monolith: 0.50
      modular_monolith: 0.25
      microservices: 0.05
      serverless_functions: 0.20
    rationale: "Monolith minimizes operational complexity for non-engineering teams."

  solo_hacker:
    probability_overrides:
      monolith: 0.45
      modular_monolith: 0.15
      microservices: 0.00
      serverless_functions: 0.40
    rationale: "Monolith or serverless â€” anything that deploys in one command."

  well_funded_startup:
    probability_overrides:
      monolith: 0.15
      modular_monolith: 0.40
      microservices: 0.30
      serverless_functions: 0.15
    rationale: "Modular monolith with planned decomposition path as team scales."

volatility:
  classification: stable
  last_assessed: 2026-02-10
  next_review: 2026-05-10
  change_drivers:
    - "Team size changes requiring different decomposition"
    - "Performance bottlenecks requiring independent scaling"

domain_applicability:
  music_attribution: 1.0
  dpp_traceability: 1.0
  generic_graph_rag: 1.0

tags:
  - architecture
  - deployment
  - scaling

references:
  - "../infrastructure/toc-infrastructure.md"
