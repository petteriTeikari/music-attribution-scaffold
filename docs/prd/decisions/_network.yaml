# Probabilistic PRD Decision Network Topology
#
# DAG adjacency list defining all decision nodes and directed edges.
# Edges flow from parent → child (upstream → downstream influence).
# Used for visualization, acyclicity validation, and traversal.
#
# Invariants:
#   - Graph must be acyclic (no circular dependencies)
#   - All node.id values must match decision_id in corresponding .decision.yaml
#   - All edge endpoints must reference declared nodes
#   - Edge direction: from (parent) → to (child)

network:
  name: "Probabilistic PRD Decision Network"
  version: "1.0.0"
  last_updated: 2026-02-10
  description: >
    Bayesian decision network for the Music Attribution Scaffold.
    5-level hierarchy (L1 Business → L5 Operations) with conditional
    probability edges encoding how upstream choices influence downstream options.

# --- Node Declarations ---

nodes:
  # L1: Business Decisions
  - id: build_vs_buy_posture
    level: L1_business
    file: L1-business/build-vs-buy-posture.decision.yaml
    title: "Build vs Buy Posture"

  - id: target_market_segment
    level: L1_business
    file: L1-business/target-market-segment.decision.yaml
    title: "Target Market Segment"

  - id: revenue_model
    level: L1_business
    file: L1-business/revenue-model.decision.yaml
    title: "Revenue Model"

  - id: regulatory_posture
    level: L1_business
    file: L1-business/regulatory-posture.decision.yaml
    title: "Regulatory Posture"

  # L2: Architecture Decisions
  - id: data_model_complexity
    level: L2_architecture
    file: L2-architecture/data-model-complexity.decision.yaml
    title: "Data Model Complexity"

  - id: api_protocol
    level: L2_architecture
    file: L2-architecture/api-protocol.decision.yaml
    title: "API Protocol"

  - id: service_decomposition
    level: L2_architecture
    file: L2-architecture/service-decomposition.decision.yaml
    title: "Service Decomposition"

  - id: ai_framework_strategy
    level: L2_architecture
    file: L2-architecture/ai-framework-strategy.decision.yaml
    title: "AI Framework Strategy"

  # L3: Implementation Decisions
  - id: primary_database
    level: L3_implementation
    file: L3-implementation/primary-database.decision.yaml
    title: "Primary Database"

  - id: graph_strategy
    level: L3_implementation
    file: L3-implementation/graph-strategy.decision.yaml
    title: "Graph Query Strategy"

  - id: vector_strategy
    level: L3_implementation
    file: L3-implementation/vector-strategy.decision.yaml
    title: "Vector Search Strategy"

  - id: llm_provider
    level: L3_implementation
    file: L3-implementation/llm-provider.decision.yaml
    title: "LLM Provider"

  - id: frontend_framework
    level: L3_implementation
    file: L3-implementation/frontend-framework.decision.yaml
    title: "Frontend Framework"

  - id: auth_strategy
    level: L3_implementation
    file: L3-implementation/auth-strategy.decision.yaml
    title: "Authentication & Authorization Strategy"

# --- Edge Declarations ---

edges:
  # L1 → L1 cross-influences
  - from: target_market_segment
    to: revenue_model
    influence: moderate
    rationale: "Market segment constrains viable revenue models"

  - from: target_market_segment
    to: regulatory_posture
    influence: weak
    rationale: "Enterprise segments demand stricter compliance"

  # L1 → L2 edges
  - from: build_vs_buy_posture
    to: data_model_complexity
    influence: moderate
    rationale: "Custom builders can handle more complex data models"

  - from: build_vs_buy_posture
    to: service_decomposition
    influence: strong
    rationale: "Build posture directly constrains decomposition options"

  - from: build_vs_buy_posture
    to: ai_framework_strategy
    influence: moderate
    rationale: "SaaS maximalists lean toward frameworks, custom builders toward direct API"

  - from: target_market_segment
    to: api_protocol
    influence: strong
    rationale: "AI consumers need MCP, creators need REST/GraphQL"

  - from: target_market_segment
    to: frontend_framework
    influence: moderate
    rationale: "API consumers don't need frontend, creators do"

  # L1 → L3 skip-connections
  - from: build_vs_buy_posture
    to: primary_database
    influence: strong
    rationale: "Build posture is the strongest predictor of database choice"

  - from: build_vs_buy_posture
    to: auth_strategy
    influence: moderate
    rationale: "Custom builders more likely to roll own auth"

  - from: target_market_segment
    to: auth_strategy
    influence: strong
    rationale: "Enterprise needs SSO, API consumers need API keys"

  - from: build_vs_buy_posture
    to: llm_provider
    influence: weak
    rationale: "Custom builders more likely to consider self-hosted models"

  # L2 → L3 edges
  - from: data_model_complexity
    to: primary_database
    influence: strong
    rationale: "Graph-enriched models require PostgreSQL+AGE or Neo4j"

  - from: data_model_complexity
    to: graph_strategy
    influence: strong
    rationale: "Data model complexity directly determines graph strategy"

  - from: primary_database
    to: graph_strategy
    influence: strong
    rationale: "Database choice constrains available graph extensions"

  - from: primary_database
    to: vector_strategy
    influence: strong
    rationale: "PostgreSQL enables pgvector, SQLite enables sqlite-vec"

  - from: ai_framework_strategy
    to: llm_provider
    influence: moderate
    rationale: "Framework choice affects viable providers"

  - from: ai_framework_strategy
    to: vector_strategy
    influence: moderate
    rationale: "No-LLM strategy reduces vector search need"

  - from: service_decomposition
    to: frontend_framework
    influence: moderate
    rationale: "Monoliths pair with server-rendered, microservices with SPAs"
