# Database Hosting
#
# Where and how the database is hosted. Tightly coupled with
# primary database choice and compute platform.
#
# Updated 2026-02-11: Added TigerData (Agentic Postgres).
# Updated 2026-02-14: Added Ubicloud managed PostgreSQL,
# updated Neon with scale-to-zero rationale and cost data,
# added EU data residency details.
# See docs/planning/deployement-finops-landscape.md

decision_id: database_hosting
title: "Database Hosting"
description: >
  Determines how the primary database is hosted and managed. Ranges
  from fully managed serverless (Neon, Supabase) to self-hosted on
  dedicated hardware. Key insight from FinOps analysis: Neon's
  scale-to-zero is optimal for MVP (90%+ idle time saves EUR 10-15/mo).
  Ubicloud provides managed PostgreSQL on Hetzner infrastructure for
  growth stage. All options use standard PostgreSQL, ensuring migration
  portability via pg_dump/pg_restore.

decision_level: L4_deployment
status: active
last_updated: 2026-02-14

options:
  - option_id: neon
    title: "Neon (Serverless PostgreSQL)"
    description: >
      Serverless PostgreSQL with auto-scaling, branching, and
      point-in-time recovery. Pay per compute-second. Scale-to-zero
      means no cost during idle periods (critical for MVP where the
      database is idle 90%+ of the time). Database branching enables
      safe schema migration testing (Alembic). pgvector optimized for
      music attribution embeddings. EU data residency (Frankfurt).
      ~EUR 17-22/month at growth stage. Current scaffold default.
    prior_probability: 0.30
    status: recommended
    complements:
      - "primary_database.postgresql_unified"
    cost_profile:
      mvp_monthly: "EUR 0-10 (scale-to-zero)"
      growth_monthly: "EUR 17-22"

  - option_id: supabase_hosted
    title: "Supabase Hosted"
    description: >
      PostgreSQL managed by Supabase with built-in auth, real-time,
      and storage. Bundled platform experience. Free tier available.
    prior_probability: 0.20
    status: viable
    complements:
      - "primary_database.supabase"

  - option_id: aws_rds
    title: "AWS RDS / Cloud SQL"
    description: >
      Managed PostgreSQL on major cloud providers. Enterprise-grade
      with Multi-AZ, automated backups, and IAM integration. Higher
      cost, better SLA guarantees.
    prior_probability: 0.15
    status: viable
    constraints:
      - "AWS/GCP account and billing setup"
      - "Higher baseline cost than serverless"

  - option_id: ubicloud_managed
    title: "Ubicloud Managed PostgreSQL"
    description: >
      Managed PostgreSQL on Hetzner Cloud infrastructure via Ubicloud
      (open-source AWS alternative). pgvector support, automated backups,
      EU data residency (Germany). ~EUR 11-15/month. Pairs naturally
      with Hetzner+Ubicloud compute. Preview status (Feb 2026) but
      uses standard PostgreSQL — easy migration to/from Neon via pg_dump.
    prior_probability: 0.10
    status: viable
    complements:
      - "primary_database.postgresql_unified"
      - "compute_platform.hetzner_ubicloud"
    cost_profile:
      growth_monthly: "EUR 11-15"
    constraints:
      - "Preview status (Feb 2026)"
      - "Limited regions (Germany, Virginia)"

  - option_id: self_managed
    title: "Self-Managed (CloudNativePG / Hetzner)"
    description: >
      PostgreSQL via CloudNativePG operator on Kubernetes, or direct
      install on Hetzner/VPS. Maximum control and cost efficiency
      (~EUR 5-10/month on Hetzner). Requires DBA skills for backup,
      replication, upgrades, and monitoring. CloudNativePG operator
      manages HA, failover, and WAL archiving on K8s.
    prior_probability: 0.10
    status: viable
    constraints:
      - "PostgreSQL administration skills (or CloudNativePG K8s operator)"
      - "Backup and recovery procedures"
      - "Monitoring and alerting setup"

  - option_id: turso
    title: "Turso (libSQL)"
    description: >
      Managed libSQL (SQLite fork) with edge replication. Extremely
      low latency, embedded-first. Limited to SQLite feature set.
    prior_probability: 0.05
    status: viable
    complements:
      - "primary_database.sqlite_turso"
    constraints:
      - "SQLite/Turso as primary database"
      - "No PostgreSQL extension support"

  - option_id: cockroach_cloud
    title: "CockroachDB Cloud"
    description: >
      Managed CockroachDB with global distribution and
      PostgreSQL compatibility. Enterprise-grade multi-region.
    prior_probability: 0.05
    status: deferred
    complements:
      - "primary_database.cockroachdb"

  - option_id: tigerdata
    title: "TigerData (Agentic Postgres)"
    description: >
      Managed PostgreSQL from TigerData (formerly Timescale) optimized
      for AI agent workloads. Key features: (1) Fluid Storage with
      sub-second copy-on-write database forking for agent sandboxes,
      (2) built-in MCP server exposing schema introspection + query
      advice as Claude-callable tools, (3) pgvectorscale (DiskANN,
      28x lower latency than Pinecone at 75% less cost), (4) pg_textsearch
      (BM25 keyword search, currently preview/in-memory only), (5) Tiger
      Lake (PostgreSQL ↔ Apache Iceberg bridge). Free tier: 2 services,
      750MB. Open-source extensions (pgvectorscale, pg_textsearch) can
      be used with any PostgreSQL. Proprietary: Fluid Storage, MCP server,
      Tiger Lake. AWS only (us-east-1, EU planned). Interesting for
      personal learning re: agentic database patterns. Key risk: vendor
      lock-in on proprietary features; pg_textsearch still preview.
    prior_probability: 0.05
    status: experimental
    complements:
      - "primary_database.postgresql_unified"
    constraints:
      - "AWS managed-only (no self-hosting)"
      - "Proprietary Fluid Storage creates vendor lock-in"
      - "pg_textsearch preview (in-memory only, disk storage TBD)"
      - "No Apache AGE support (graph via recursive CTEs only)"

conditional_on:
  - parent_decision_id: primary_database
    influence_strength: strong
    conditional_table:
      - given_parent_option: postgresql_unified
        then_probabilities:
          neon: 0.30
          supabase_hosted: 0.10
          aws_rds: 0.15
          ubicloud_managed: 0.15
          self_managed: 0.10
          turso: 0.00
          cockroach_cloud: 0.05
          tigerdata: 0.15
      - given_parent_option: supabase
        then_probabilities:
          neon: 0.05
          supabase_hosted: 0.70
          aws_rds: 0.05
          ubicloud_managed: 0.05
          self_managed: 0.05
          turso: 0.00
          cockroach_cloud: 0.10
          tigerdata: 0.00
      - given_parent_option: sqlite_turso
        then_probabilities:
          neon: 0.00
          supabase_hosted: 0.00
          aws_rds: 0.00
          ubicloud_managed: 0.00
          self_managed: 0.10
          turso: 0.85
          cockroach_cloud: 0.05
          tigerdata: 0.00
      - given_parent_option: cockroachdb
        then_probabilities:
          neon: 0.05
          supabase_hosted: 0.00
          aws_rds: 0.10
          ubicloud_managed: 0.00
          self_managed: 0.15
          turso: 0.00
          cockroach_cloud: 0.70
          tigerdata: 0.00

  - parent_decision_id: compute_platform
    influence_strength: moderate
    conditional_table:
      - given_parent_option: render
        then_probabilities:
          neon: 0.40
          supabase_hosted: 0.20
          aws_rds: 0.05
          ubicloud_managed: 0.05
          self_managed: 0.05
          turso: 0.10
          cockroach_cloud: 0.05
          tigerdata: 0.10
      - given_parent_option: vercel_plus_backend
        then_probabilities:
          neon: 0.30
          supabase_hosted: 0.25
          aws_rds: 0.10
          ubicloud_managed: 0.05
          self_managed: 0.05
          turso: 0.15
          cockroach_cloud: 0.05
          tigerdata: 0.05
      - given_parent_option: railway
        then_probabilities:
          neon: 0.30
          supabase_hosted: 0.20
          aws_rds: 0.10
          ubicloud_managed: 0.05
          self_managed: 0.05
          turso: 0.15
          cockroach_cloud: 0.05
          tigerdata: 0.10
      - given_parent_option: fly_io
        then_probabilities:
          neon: 0.25
          supabase_hosted: 0.15
          aws_rds: 0.15
          ubicloud_managed: 0.10
          self_managed: 0.10
          turso: 0.10
          cockroach_cloud: 0.10
          tigerdata: 0.05
      - given_parent_option: hetzner_ubicloud
        then_probabilities:
          neon: 0.15
          supabase_hosted: 0.05
          aws_rds: 0.05
          ubicloud_managed: 0.45
          self_managed: 0.10
          turso: 0.05
          cockroach_cloud: 0.05
          tigerdata: 0.10
      - given_parent_option: hetzner_baremetal
        then_probabilities:
          neon: 0.10
          supabase_hosted: 0.05
          aws_rds: 0.05
          ubicloud_managed: 0.20
          self_managed: 0.45
          turso: 0.05
          cockroach_cloud: 0.05
          tigerdata: 0.05
      - given_parent_option: aws_ecs
        then_probabilities:
          neon: 0.10
          supabase_hosted: 0.05
          aws_rds: 0.35
          ubicloud_managed: 0.00
          self_managed: 0.05
          turso: 0.05
          cockroach_cloud: 0.15
          tigerdata: 0.25

archetype_weights:
  engineer_heavy_startup:
    probability_overrides:
      neon: 0.20
      supabase_hosted: 0.10
      aws_rds: 0.25
      self_managed: 0.20
      turso: 0.05
      cockroach_cloud: 0.10
      tigerdata: 0.10
    rationale: "Engineers can manage any option. TigerData interesting for agentic patterns."

  musician_first_team:
    probability_overrides:
      neon: 0.30
      supabase_hosted: 0.40
      aws_rds: 0.05
      self_managed: 0.00
      turso: 0.15
      cockroach_cloud: 0.05
      tigerdata: 0.05
    rationale: "Supabase bundled experience. TigerData too specialized for non-engineers."

  solo_hacker:
    probability_overrides:
      neon: 0.30
      supabase_hosted: 0.25
      aws_rds: 0.05
      self_managed: 0.05
      turso: 0.25
      cockroach_cloud: 0.05
      tigerdata: 0.05
    rationale: "Free tiers matter. TigerData free tier interesting for experimentation."

  well_funded_startup:
    probability_overrides:
      neon: 0.15
      supabase_hosted: 0.10
      aws_rds: 0.30
      self_managed: 0.10
      turso: 0.05
      cockroach_cloud: 0.15
      tigerdata: 0.15
    rationale: "AWS RDS for enterprise. TigerData's MCP server appealing for agentic workflows."

volatility:
  classification: shifting
  last_assessed: 2026-02-11
  next_review: 2026-04-11
  change_drivers:
    - "Neon pricing evolution"
    - "Supabase extension support changes"
    - "Turso feature parity improvements"
    - "TigerData Agentic Postgres maturation (pg_textsearch, Fluid Storage)"
    - "Databricks/Neon acquisition impact on serverless PostgreSQL landscape"

domain_applicability:
  music_attribution: 1.0
  dpp_traceability: 1.0
  generic_graph_rag: 1.0

tags:
  - deployment
  - database
  - hosting

references:
  - "../infrastructure/toc-infrastructure.md"
  - "../defaults.yaml"
  - "../../planning/deployement-finops-landscape.md"
  - "https://www.tigerdata.com/agentic-postgres"
  - "https://www.tigerdata.com/blog/its-2026-just-use-postgres"
  - "https://github.com/timescale/pgvectorscale"  # OSS DiskANN extension
  - "https://github.com/timescale/pg_textsearch"  # OSS BM25 extension (preview)
