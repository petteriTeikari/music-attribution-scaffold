# Database Hosting
#
# Where and how the database is hosted. Tightly coupled with
# primary database choice and compute platform.

decision_id: database_hosting
title: "Database Hosting"
description: >
  Determines how the primary database is hosted and managed. Ranges
  from fully managed serverless (Neon, Supabase) to self-hosted on
  dedicated hardware. The choice interacts with primary database
  selection and compute platform.

decision_level: L4_deployment
status: active
last_updated: 2026-02-10

options:
  - option_id: neon
    title: "Neon (Serverless PostgreSQL)"
    description: >
      Serverless PostgreSQL with auto-scaling, branching, and
      point-in-time recovery. Pay per compute-second. Excellent
      developer experience. Current scaffold default.
    prior_probability: 0.30
    status: recommended
    complements:
      - "primary_database.postgresql_unified"

  - option_id: supabase_hosted
    title: "Supabase Hosted"
    description: >
      PostgreSQL managed by Supabase with built-in auth, real-time,
      and storage. Bundled platform experience. Free tier available.
    prior_probability: 0.25
    status: viable
    complements:
      - "primary_database.supabase"

  - option_id: aws_rds
    title: "AWS RDS / Cloud SQL"
    description: >
      Managed PostgreSQL on major cloud providers. Enterprise-grade
      with Multi-AZ, automated backups, and IAM integration. Higher
      cost, better SLA guarantees.
    prior_probability: 0.15
    status: viable
    constraints:
      - "AWS/GCP account and billing setup"
      - "Higher baseline cost than serverless"

  - option_id: self_managed
    title: "Self-Managed (Hetzner/VPS)"
    description: >
      PostgreSQL installed on self-managed servers. Maximum control
      and cost efficiency. Requires DBA skills for backup, replication,
      upgrades, and monitoring.
    prior_probability: 0.10
    status: viable
    constraints:
      - "PostgreSQL administration skills"
      - "Backup and recovery procedures"
      - "Monitoring and alerting setup"

  - option_id: turso
    title: "Turso (libSQL)"
    description: >
      Managed libSQL (SQLite fork) with edge replication. Extremely
      low latency, embedded-first. Limited to SQLite feature set.
    prior_probability: 0.10
    status: viable
    complements:
      - "primary_database.sqlite_turso"
    constraints:
      - "SQLite/Turso as primary database"
      - "No PostgreSQL extension support"

  - option_id: cockroach_cloud
    title: "CockroachDB Cloud"
    description: >
      Managed CockroachDB with global distribution and
      PostgreSQL compatibility. Enterprise-grade multi-region.
    prior_probability: 0.10
    status: deferred
    complements:
      - "primary_database.cockroachdb"

conditional_on:
  - parent_decision_id: primary_database
    influence_strength: strong
    conditional_table:
      - given_parent_option: postgresql_unified
        then_probabilities:
          neon: 0.40
          supabase_hosted: 0.15
          aws_rds: 0.20
          self_managed: 0.15
          turso: 0.00
          cockroach_cloud: 0.10
      - given_parent_option: supabase
        then_probabilities:
          neon: 0.10
          supabase_hosted: 0.70
          aws_rds: 0.05
          self_managed: 0.05
          turso: 0.00
          cockroach_cloud: 0.10
      - given_parent_option: sqlite_turso
        then_probabilities:
          neon: 0.00
          supabase_hosted: 0.00
          aws_rds: 0.00
          self_managed: 0.10
          turso: 0.85
          cockroach_cloud: 0.05
      - given_parent_option: cockroachdb
        then_probabilities:
          neon: 0.05
          supabase_hosted: 0.00
          aws_rds: 0.10
          self_managed: 0.15
          turso: 0.00
          cockroach_cloud: 0.70

  - parent_decision_id: compute_platform
    influence_strength: moderate
    conditional_table:
      - given_parent_option: render
        then_probabilities:
          neon: 0.40
          supabase_hosted: 0.25
          aws_rds: 0.10
          self_managed: 0.10
          turso: 0.10
          cockroach_cloud: 0.05
      - given_parent_option: vercel_plus_backend
        then_probabilities:
          neon: 0.35
          supabase_hosted: 0.30
          aws_rds: 0.10
          self_managed: 0.05
          turso: 0.15
          cockroach_cloud: 0.05
      - given_parent_option: railway
        then_probabilities:
          neon: 0.35
          supabase_hosted: 0.25
          aws_rds: 0.10
          self_managed: 0.10
          turso: 0.15
          cockroach_cloud: 0.05
      - given_parent_option: fly_io
        then_probabilities:
          neon: 0.30
          supabase_hosted: 0.15
          aws_rds: 0.15
          self_managed: 0.15
          turso: 0.15
          cockroach_cloud: 0.10
      - given_parent_option: hetzner_dedicated
        then_probabilities:
          neon: 0.15
          supabase_hosted: 0.10
          aws_rds: 0.10
          self_managed: 0.45
          turso: 0.10
          cockroach_cloud: 0.10
      - given_parent_option: aws_ecs
        then_probabilities:
          neon: 0.15
          supabase_hosted: 0.10
          aws_rds: 0.40
          self_managed: 0.10
          turso: 0.05
          cockroach_cloud: 0.20

archetype_weights:
  engineer_heavy_startup:
    probability_overrides:
      neon: 0.25
      supabase_hosted: 0.10
      aws_rds: 0.25
      self_managed: 0.20
      turso: 0.05
      cockroach_cloud: 0.15
    rationale: "Engineers can manage RDS or self-hosted. Neon for simplicity."

  musician_first_team:
    probability_overrides:
      neon: 0.30
      supabase_hosted: 0.40
      aws_rds: 0.05
      self_managed: 0.00
      turso: 0.15
      cockroach_cloud: 0.10
    rationale: "Supabase bundled experience. Neon if PostgreSQL-only."

  solo_hacker:
    probability_overrides:
      neon: 0.30
      supabase_hosted: 0.25
      aws_rds: 0.05
      self_managed: 0.05
      turso: 0.30
      cockroach_cloud: 0.05
    rationale: "Free tiers matter. Turso for SQLite, Neon/Supabase for PostgreSQL."

  well_funded_startup:
    probability_overrides:
      neon: 0.20
      supabase_hosted: 0.10
      aws_rds: 0.35
      self_managed: 0.10
      turso: 0.05
      cockroach_cloud: 0.20
    rationale: "AWS RDS for enterprise credibility. CockroachDB for global scale."

volatility:
  classification: shifting
  last_assessed: 2026-02-10
  next_review: 2026-04-10
  change_drivers:
    - "Neon pricing evolution"
    - "Supabase extension support changes"
    - "Turso feature parity improvements"

domain_applicability:
  music_attribution: 1.0
  dpp_traceability: 1.0
  generic_graph_rag: 1.0

tags:
  - deployment
  - database
  - hosting

references:
  - "../infrastructure/toc-infrastructure.md"
  - "../defaults.yaml"
