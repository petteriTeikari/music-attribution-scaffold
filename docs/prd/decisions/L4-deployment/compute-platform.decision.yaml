# Compute Platform
#
# Where application code runs. Directly influenced by build-vs-buy
# posture and service decomposition strategy.

decision_id: compute_platform
title: "Compute Platform"
description: >
  Selects the primary compute platform for running application code.
  The choice spans from zero-config PaaS (Render, Railway) through
  serverless-first platforms (Vercel) to self-managed infrastructure
  (Hetzner dedicated, AWS ECS). Key trade-offs: operational complexity
  vs. cost efficiency vs. scaling flexibility.

decision_level: L4_deployment
status: active
last_updated: 2026-02-10

options:
  - option_id: render
    title: "Render"
    description: >
      PaaS with Docker-based deployments, managed databases, background
      workers, and cron jobs. Simple git-push deployment. Good balance
      of simplicity and control. Current scaffold default.
    prior_probability: 0.30
    status: recommended

  - option_id: vercel_plus_backend
    title: "Vercel + Separate Backend"
    description: >
      Vercel for frontend (Next.js/SvelteKit), separate backend service
      on Railway/Render/Fly.io. Optimized for frontend-heavy architectures
      with edge deployment capabilities.
    prior_probability: 0.20
    status: viable
    complements:
      - "frontend_framework.nextjs"

  - option_id: railway
    title: "Railway"
    description: >
      Developer-friendly PaaS with Docker support, managed databases,
      and cron jobs. Similar to Render with different pricing model
      (usage-based). Good developer experience.
    prior_probability: 0.15
    status: viable

  - option_id: fly_io
    title: "Fly.io"
    description: >
      Edge-first platform running containers close to users. Excellent
      for global deployments. Firecracker microVMs, built-in load
      balancing, volumes for persistent storage.
    prior_probability: 0.10
    status: viable
    constraints:
      - "Familiarity with Fly.io deployment model"
      - "Volume management for stateful workloads"

  - option_id: hetzner_dedicated
    title: "Hetzner Dedicated/Cloud"
    description: >
      Self-managed infrastructure on Hetzner's affordable European servers.
      Maximum cost efficiency and control. Requires Docker Compose or
      Kubernetes knowledge and all operational responsibilities.
    prior_probability: 0.10
    status: viable
    constraints:
      - "Linux server administration skills"
      - "Self-managed TLS, monitoring, backups"
      - "No managed database (must self-host or use external)"

  - option_id: aws_ecs
    title: "AWS ECS / Cloud Run"
    description: >
      Container orchestration on major cloud providers. Enterprise-grade
      scaling, IAM integration, managed service mesh. Higher complexity
      and cost but maximum flexibility and ecosystem.
    prior_probability: 0.15
    status: deferred
    constraints:
      - "AWS/GCP expertise on team"
      - "Higher monthly baseline cost"
      - "IaC tooling recommended (Terraform/Pulumi)"

conditional_on:
  - parent_decision_id: build_vs_buy_posture
    influence_strength: strong
    conditional_table:
      - given_parent_option: custom_build
        then_probabilities:
          render: 0.15
          vercel_plus_backend: 0.10
          railway: 0.10
          fly_io: 0.15
          hetzner_dedicated: 0.25
          aws_ecs: 0.25
      - given_parent_option: managed_services
        then_probabilities:
          render: 0.35
          vercel_plus_backend: 0.20
          railway: 0.20
          fly_io: 0.10
          hetzner_dedicated: 0.05
          aws_ecs: 0.10
      - given_parent_option: saas_maximalist
        then_probabilities:
          render: 0.25
          vercel_plus_backend: 0.35
          railway: 0.20
          fly_io: 0.10
          hetzner_dedicated: 0.00
          aws_ecs: 0.10

  - parent_decision_id: service_decomposition
    influence_strength: moderate
    conditional_table:
      - given_parent_option: monolith
        then_probabilities:
          render: 0.35
          vercel_plus_backend: 0.10
          railway: 0.20
          fly_io: 0.15
          hetzner_dedicated: 0.10
          aws_ecs: 0.10
      - given_parent_option: modular_monolith
        then_probabilities:
          render: 0.30
          vercel_plus_backend: 0.15
          railway: 0.15
          fly_io: 0.10
          hetzner_dedicated: 0.10
          aws_ecs: 0.20
      - given_parent_option: microservices
        then_probabilities:
          render: 0.15
          vercel_plus_backend: 0.10
          railway: 0.10
          fly_io: 0.15
          hetzner_dedicated: 0.15
          aws_ecs: 0.35
      - given_parent_option: serverless_functions
        then_probabilities:
          render: 0.10
          vercel_plus_backend: 0.45
          railway: 0.15
          fly_io: 0.10
          hetzner_dedicated: 0.00
          aws_ecs: 0.20

archetype_weights:
  engineer_heavy_startup:
    probability_overrides:
      render: 0.15
      vercel_plus_backend: 0.10
      railway: 0.10
      fly_io: 0.15
      hetzner_dedicated: 0.20
      aws_ecs: 0.30
    rationale: "Engineers can handle AWS/Hetzner complexity and optimize costs."

  musician_first_team:
    probability_overrides:
      render: 0.35
      vercel_plus_backend: 0.30
      railway: 0.20
      fly_io: 0.05
      hetzner_dedicated: 0.00
      aws_ecs: 0.10
    rationale: "PaaS simplicity is essential. Render or Vercel."

  solo_hacker:
    probability_overrides:
      render: 0.30
      vercel_plus_backend: 0.25
      railway: 0.25
      fly_io: 0.10
      hetzner_dedicated: 0.05
      aws_ecs: 0.05
    rationale: "PaaS with free tiers. Railway or Render."

  well_funded_startup:
    probability_overrides:
      render: 0.20
      vercel_plus_backend: 0.15
      railway: 0.10
      fly_io: 0.10
      hetzner_dedicated: 0.10
      aws_ecs: 0.35
    rationale: "AWS ECS for enterprise credibility and scaling. PaaS for speed."

volatility:
  classification: shifting
  last_assessed: 2026-02-10
  next_review: 2026-04-10
  change_drivers:
    - "PaaS pricing changes (Render, Railway, Vercel)"
    - "AWS/GCP pricing adjustments"
    - "Hetzner cloud region expansion"
    - "Platform-specific feature additions"

domain_applicability:
  music_attribution: 1.0
  dpp_traceability: 1.0
  generic_graph_rag: 1.0

tags:
  - deployment
  - compute
  - infrastructure

references:
  - "../infrastructure/toc-infrastructure.md"
  - "../defaults.yaml"
